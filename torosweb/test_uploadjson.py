# Upload targets directly:
targetsjson = """{
  "alert": {
    "ligo_run": "O3",
    "graceid": "MS181101ab",
    "SEtype": "T",
    "datetime": "2018-11-01T22:22:46.654437"
  },
  "gcnnotice": {
    "gcntype": "Initial",
    "datetime": "2018-11-01T22:36:25"
  },
  "assignments": {
    "EABA": {
      "PGC079541": 6.464510575796884e-05,
      "PGC023044": 6.39126338280551e-05,
      "PGC080348": 6.323100474600469e-05,
      "PGC2065934": 6.23122254622477e-05,
      "PGC086840": 6.225678711622934e-05,
      "PGC023341": 6.219938562321213e-05,
      "NGC2415": 6.095561194484184e-05,
      "PGC090811": 6.0671241695529065e-05,
      "SDSSJ074821.09+342006.8": 5.963021527172012e-05,
      "UGC04029": 5.959417039262141e-05,
      "UGC04306": 5.9305721584914734e-05,
      "PGC022420": 5.928659774570314e-05,
      "UGC03937": 5.91918907638346e-05,
      "PGC087419": 5.8957669199920675e-05,
      "PGC019864": 5.889286228161441e-05,
      "NGC2683": 5.883448753529527e-05,
      "PGC021407": 5.859878529269196e-05,
      "NGC2532": 5.834140836018698e-05,
      "UGC04831": 5.826764978728867e-05,
      "UGC03723": 5.819072558024484e-05
    },
    "Macon": {
      "PGC079541": 6.464510575796884e-05,
      "PGC023044": 6.39126338280551e-05,
      "PGC080348": 6.323100474600469e-05,
      "PGC2065934": 6.23122254622477e-05,
      "PGC086840": 6.225678711622934e-05,
      "PGC023341": 6.219938562321213e-05,
      "NGC2415": 6.095561194484184e-05,
      "PGC090811": 6.0671241695529065e-05,
      "SDSSJ074821.09+342006.8": 5.963021527172012e-05,
      "UGC04029": 5.959417039262141e-05,
      "UGC04306": 5.9305721584914734e-05,
      "PGC022420": 5.928659774570314e-05,
      "UGC03937": 5.91918907638346e-05,
      "PGC087419": 5.8957669199920675e-05,
      "PGC019864": 5.889286228161441e-05,
      "NGC2683": 5.883448753529527e-05,
      "PGC021407": 5.859878529269196e-05,
      "NGC2532": 5.834140836018698e-05,
      "UGC04831": 5.826764978728867e-05,
      "UGC03723": 5.819072558024484e-05
    },
    "Mamalluca": {
      "PGC079541": 6.464510575796884e-05,
      "PGC023044": 6.39126338280551e-05,
      "PGC080348": 6.323100474600469e-05,
      "PGC2065934": 6.23122254622477e-05,
      "PGC086840": 6.225678711622934e-05,
      "PGC023341": 6.219938562321213e-05,
      "NGC2415": 6.095561194484184e-05,
      "PGC090811": 6.0671241695529065e-05,
      "SDSSJ074821.09+342006.8": 5.963021527172012e-05,
      "UGC04029": 5.959417039262141e-05,
      "UGC04306": 5.9305721584914734e-05,
      "PGC022420": 5.928659774570314e-05,
      "UGC03937": 5.91918907638346e-05,
      "PGC087419": 5.8957669199920675e-05,
      "PGC019864": 5.889286228161441e-05,
      "NGC2683": 5.883448753529527e-05,
      "PGC021407": 5.859878529269196e-05,
      "NGC2532": 5.834140836018698e-05,
      "UGC04831": 5.826764978728867e-05,
      "UGC03723": 5.819072558024484e-05
    },
    "Nompuewenu": {
      "PGC079541": 6.464510575796884e-05,
      "PGC023044": 6.39126338280551e-05,
      "PGC080348": 6.323100474600469e-05,
      "PGC2065934": 6.23122254622477e-05,
      "PGC086840": 6.225678711622934e-05,
      "PGC023341": 6.219938562321213e-05,
      "NGC2415": 6.095561194484184e-05,
      "PGC090811": 6.0671241695529065e-05,
      "SDSSJ074821.09+342006.8": 5.963021527172012e-05,
      "UGC04029": 5.959417039262141e-05,
      "UGC04306": 5.9305721584914734e-05,
      "PGC022420": 5.928659774570314e-05,
      "UGC03937": 5.91918907638346e-05,
      "PGC087419": 5.8957669199920675e-05,
      "PGC019864": 5.889286228161441e-05,
      "NGC2683": 5.883448753529527e-05,
      "PGC021407": 5.859878529269196e-05,
      "NGC2532": 5.834140836018698e-05,
      "UGC04831": 5.826764978728867e-05,
      "UGC03723": 5.819072558024484e-05
    },
    "Guillermo Haro": {
      "PGC079541": 6.464510575796884e-05,
      "PGC023044": 6.39126338280551e-05,
      "PGC080348": 6.323100474600469e-05,
      "PGC2065934": 6.23122254622477e-05,
      "PGC086840": 6.225678711622934e-05,
      "PGC023341": 6.219938562321213e-05,
      "NGC2415": 6.095561194484184e-05,
      "PGC090811": 6.0671241695529065e-05,
      "SDSSJ074821.09+342006.8": 5.963021527172012e-05,
      "UGC04029": 5.959417039262141e-05,
      "UGC04306": 5.9305721584914734e-05,
      "PGC022420": 5.928659774570314e-05,
      "UGC03937": 5.91918907638346e-05,
      "PGC087419": 5.8957669199920675e-05,
      "PGC019864": 5.889286228161441e-05,
      "NGC2683": 5.883448753529527e-05,
      "PGC021407": 5.859878529269196e-05,
      "NGC2532": 5.834140836018698e-05,
      "UGC04831": 5.826764978728867e-05,
      "UGC03723": 5.819072558024484e-05
    }
  }
}
"""

site_url = 'http://127.0.0.1:8000/'
url_login = site_url + 'account/login/'
url_uploadjson = site_url + 'broker/uploadjson/'
url_logout = site_url + 'account/logout/'

import requests

# Log into a session with our user
client = requests.session()
client.get(url_login)
csrftoken = client.cookies['csrftoken']
login_data = {'username':'admin',
              'password':'1234',
              'csrfmiddlewaretoken':csrftoken,
              }
r1 = client.post(url_login, data=login_data)

sessionid = client.cookies['sessionid']
loadjson_data = {'targets.json':targetsjson,
                 'csrfmiddlewaretoken':csrftoken,
                 'sessionid': sessionid}
r2 = client.post(url_uploadjson, data=loadjson_data)

# Log out
r3 = client.get(url_logout, data={'sessionid': sessionid})
